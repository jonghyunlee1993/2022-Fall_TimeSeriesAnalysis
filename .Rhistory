lines(new_data, pred$uwr, lty=3, col="red")
lines(new_data, pred$lwr, lty=2, col="blue")
lines(new_data, pred$uwr, lty=3, col="red")
ts.plot(new_z.ts, type="o")
pred$lwr
new_data
lines(as.vector(new_data), pred$lwr, lty=2, col="blue")
as.vector(new_data)
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$uwr, lty=3, col="red")
pred
lines(new_data$t, pred$upr, lty=3, col="red")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$upr, lty=2, col="blue")
model = lm(lndept ~ first + second)
summary(model)
t = 1:length(dept)
## Exercise 2.6
dept = scan("data/depart.txt")
t = 1:length(dept)
dept.ts = ts(dept, frequency=12, start=c(1984, 1))
lndept = log(dept.ts)
first = sin(pi * t / 12)
second = sin(pi * t / 6)
model = lm(lndept ~ first + second)
summary(model)
first = sin(pi * t / 4)
second = sin(pi * t / 6)
model = lm(lndept ~ first + second)
summary(model)
first = sin(pi * t / 3)
model = lm(lndept ~ first)
summary(model)
ts.plot(dept.ts)
first = sin(pi * t / 12 + 6)
second = sin(pi * t / 12 + 3)
model = lm(lndept ~ first + second)
summary(model)
ts.plot(ts(fitted(model)))
ts.plot(ts(resid(model)))
first = sin(pi * t / 12)
second = sin(pi * t / 12 + 3)
model = lm(lndept ~ first + second)
summary(model)
ts.plot(ts(resid(model)))
first = sin(pi * t / 12)
second = sin(pi * t / 12 + pi/4)
model = lm(lndept ~ first + second)
summary(model)
ts.plot(ts(resid(model)))
ts.plot(first)
ts.plot(dept.ts)
first = 500 * sin(pi * t / 12)
ts.plot(first)
first = 500 * sin(pi * t / 12) + 500
ts.plot(first)
ts.plot(dept.ts)
first = sin(2 * pi * t / 12)
ts.plot(first)
first = sin(2 * pi * t / 12)
second = sin(2 * pi * t / 12*2)
model = lm(lndept ~ first + second)
summary(model)
ts.plot(ts(resid(model)))
first = sin(2 * pi * t / 12)
second = cos(2 * pi * t / 12)
model = lm(lndept ~ first + second)
summary(model)
ts.plot(ts(resid(model)))
first = sin(2 * pi * t / 12)
second = cos(2 * pi * t / 12)
model = lm(lndept ~ first * t + second * t)
summary(model)
ts.plot(ts(resid(model)))
model = lm(lndept ~ t + first + second)
summary(model)
ts.plot(ts(resid(model)))
first = sin(pi * t / 12)
second = cos(pi * t / 12)
model = lm(lndept ~ t + first + second)
summary(model)
ts.plot(ts(resid(model)))
x1 = sin(2 * pi * t / 12)
x2 = cos(2 * pi * t / 12)
x3 = sin(2 * pi * t / 12*2)
x4 = cos(2 * pi * t / 12*2)
x5 = sin(2 * pi * t / 12*3)
x6 = cos(2 * pi * t / 12*3)
model = lm(lndept ~ t + x1 + x2 + x3 + x4 + x5 + x6)
summary(model)
ts.plot(ts(resid(model)))
ts.plot(ts(resid(model)))
summary(model)
x7 = sin(2 * pi * t / 12*4)
x8 = cos(2 * pi * t / 12*4)
model = lm(lndept ~ t + x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8)
summary(model)
ts.plot(ts(resid(model)))
model = lm(lndept ~ t + x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10)
summary(model)
ts.plot(ts(resid(model)))
x9 = sin(2 * pi * t / 12*6)
x10 = cos(2 * pi * t / 12*6)
model = lm(lndept ~ t + x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10)
summary(model)
ts.plot(ts(resid(model)))
acf(resid(model))
## Exercise 2.9
dept = scan("data/book.txt")
t = 1:length(dept)
## Exercise 2.9
book = scan("data/book.txt")
t = 1:length(dept)
ts.plot(book)
model = lm(book ~ t + t^2)
summary(model)
t2 = t * t
model = lm(book ~ t + t2)
summary(model)
t = 1:length(dept)
model = lm(book ~ t)
summary(model)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
t = 1:length(dept)
y = factor(cycle(ts(t, frequency=12)))
model = lm(book ~ t + y)
summary(model)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
model = lm(book ~ t)
summary(model)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
new_data = data.frame(t=c(16,17,18,19,20))
new_data = data.frame(t=c(31:42))
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
pred
new_z = c(z, pred$fit)
new_z.ts = ts(new_z)
ts.plot(new_z.ts, type="o")
## Exercise 2.9
book = scan("data/book.txt")
t = 1:length(dept)
model = lm(book ~ t)
summary(model)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
new_data = data.frame(t=c(31:42))
new_data
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
pred
new_z = c(z, pred$fit)
new_z.ts = ts(new_z)
ts.plot(new_z.ts, type="o")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$upr, lty=2, col="blue")
## Exercise 2.9
z = scan("data/book.txt")
t = 1:length(dept)
model = lm(book ~ t)
summary(model)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
new_data = data.frame(t=c(31:42))
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
new_z = c(z, pred$fit)
new_z.ts = ts(new_z)
ts.plot(new_z.ts, type="o")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$upr, lty=2, col="blue")
dept = scan("data/depart.txt")
n = 1:length(dept)
time = ts(n, frequency=12, start=c(1984, 1))
dept.ts = ts(dept, frequency=12, start=c(1984, 1))
lndept = log(dept.ts)
y = factor(cycle(time))
fit = lm(lndept ~ 0 + time + y)
anova(fit)
summary(fit)
resid = ts(resid(fit), start=c(1984, 1), frequency=12)
acf2(resid, main="Residuals of ACF & PACF")
autoreg = arima(residuals(fit), order=c(3, 0, 0))
summary(autoreg)
plot(resid(autoreg), main="Figure 2-17 Residuals after fitted autoregresive model")
abline(h=0)
c(303, 298, 303, 314, 303, 314, 310, 324, 317, 326, 323, 324,331, 330, 332)
t = 1:length(z)
z.ts = ts(z)
model = lm(z ~ t)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
## Exersize 2.2
z = c(303, 298, 303, 314, 303, 314, 310, 324, 317, 326, 323, 324,331, 330, 332)
t = 1:length(z)
z.ts = ts(z)
model = lm(z ~ t)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
## Exersize 2.2
z = c(303, 298, 303, 314, 303, 314, 310, 324, 317, 326, 323, 324,331, 330, 332)
t = 1:length(z)
z.ts = ts(z)
model = lm(z ~ t)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
new_data = data.frame(t=c(16,17,18,19,20))
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
new_z = c(z, pred$fit)
new_z.ts = ts(new_z)
ts.plot(new_z.ts, type="o")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$upr, lty=2, col="blue")
## Exersize 2.2
z = c(303, 298, 303, 314, 303, 314, 310, 324, 317, 326, 323, 324,331, 330, 332)
t = 1:length(z)
z.ts = ts(z)
model = lm(z ~ t)
summary(model)
dept = scan("data/depart.txt")
t = 1:length(dept)
dept.ts = ts(dept, frequency=12, start=c(1984, 1))
lndept = log(dept.ts)
ts.plot(dept.ts)
x1 = sin(2 * pi * t / 12)
x2 = cos(2 * pi * t / 12)
x3 = sin(2 * pi * t / 12*2)
x4 = cos(2 * pi * t / 12*2)
x5 = sin(2 * pi * t / 12*3)
x6 = cos(2 * pi * t / 12*3)
x7 = sin(2 * pi * t / 12*4)
x8 = cos(2 * pi * t / 12*4)
x9 = sin(2 * pi * t / 12*6)
x10 = cos(2 * pi * t / 12*6)
model = lm(lndept ~ t + x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10)
summary(model)
ts.plot(ts(resid(model)))
## Exercise 2.9
z = scan("data/book.txt")
t = 1:length(z)
model = lm(book ~ t)
summary(model)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
new_data = data.frame(t=c(31:42))
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
new_z = c(z, pred$fit)
new_z.ts = ts(new_z)
ts.plot(new_z.ts, type="o")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$upr, lty=2, col="blue")
rm(list = ls())
setwd("Workspace/2022-Fall_TimeSeriesAnalysis/")
## Example 2.1
library(lmtest)
z = scan("data/population.txt")
pop = round(z / 10000)
pop = ts(pop, start=c(1960))
t = 1:length(pop)
t2 = t * t
m1 = lm(pop ~ t)
dwtest(m1)
summary(m1)
ts.plot(pop, fitted(m1), xlab="year", ylab="population", lty=1:2,
main="Figure 2-3 The total population and the predicted values")
acf(resid(m1), main="Residuals of ACF")
ts.plot(pop, fitted(m2), xlab="year", ylab="population", lty=1:2,
main="Figure 2-5 A predcited values of second order trend model")
ts.plot(resid(m2), type="o", ylab="residual",
main="Figure 2-6 Residuals of second order trend model")
m2 = lm(pop ~ t + t2)
summary(m2)
ts.plot(pop, fitted(m2), xlab="year", ylab="population", lty=1:2,
main="Figure 2-5 A predcited values of second order trend model")
ts.plot(resid(m2), type="o", ylab="residual",
main="Figure 2-6 Residuals of second order trend model")
abline(h=0)
legend("topleft", legend=c("pop", "fitted"), lty=1:2)
lnpop = log(pop)
m3 = lm(lnpop ~ t + t2)
dwtest(m3)
summary(m3)
ts.plot(lnpop, fitted(m3), xlab="year", ylab="log population", lty=1:2,
main="A predcited values of second order trend model with log transformation")
legend("topleft", legend=c("lnpop", "fitted"), lty=1:2)
ts.plot(resid(m3), ylab="residual",
main="Figure 2-7 Residuals of second order trend model with log transformation")
abline(h=0)
## Example 2.2
library(astsa)
z = scan("data/depart.txt")
dep = ts(z, frequency=12, start=c(1984, 1))
ts.plot(dep, ylab="depart",
main="Figure 2-9 Sales revenue of department store")
lndep = log(dep)
ts.plot(lndep, ylab="log depart",
main="Figure 2-10 Log transformed sales revenue of department store")
trend = time(lndep) - 1984
y = factor(cycle(lndep))
reg = lm(lndep ~ 0 + trend + y)
dwtest(reg)
summary(reg)
model.matrix(reg)
resid = ts(resid(reg), start=c(1984, 1), frequency=12)
ts.plot(resid(reg), ylab="residual",
main="Figure 2-11 Residuals")
abline(h=0)
## Example 2.3
z = scan("data/catv.txt")
k = 70000000
t = 1:length(z)
year = t + 1969
catv = ts(z, start=c(1970))
lncatv = log(k / catv - 1)
## Example 2.3
z = scan("data/catv.txt")
k = 70000000
t = 1:length(z)
year = t + 1969
catv = ts(z, start=c(1970))
lncatv = log(k / catv - 1)
ts.plot(catv, xlab="year", ylab="catv",
main="Figure 2-13 Number of subscribers of Cable TV")
ts.plot(lncatv, xlab="year", ylab="catv",
main="Figure 2-14 Number of subscribers (log transformed) of Cable TV")
fit = lm(lncatv ~ t)
summary(fit)
pred = k / (exp(fitted(fit)) + 1)
resid = catv - pred
y = data.frame(catv, pred)
fig = ts(y, start=c(1970))
ts.plot(fig, xlab="year", ylab="catv", lty=1:2,
main="Figure 2-15 Predicted value and observed value")
legend("right", legend =c("Catv", "Predict"), lty=1:2)
ts.plot(resid, xlab="time", ylab="residual",
main="Figure 2-16 Residuals")
abline(h=0)
## Example 2.4
dept = scan("data/depart.txt")
n = 1:length(dept)
time = ts(n, frequency=12, start=c(1984, 1))
dept.ts = ts(dept, frequency=12, start=c(1984, 1))
lndept = log(dept.ts)
y = factor(cycle(time))
fit = lm(lndept ~ 0 + time + y)
anova(fit)
summary(fit)
resid = ts(resid(fit), start=c(1984, 1), frequency=12)
acf2(resid, main="Residuals of ACF & PACF")
autoreg = arima(residuals(fit), order=c(3, 0, 0))
summary(autoreg)
plot(resid(autoreg), main="Figure 2-17 Residuals after fitted autoregresive model")
abline(h=0)
## Figure 2.8
n = 100
t = 1:n
a1 = -0.8
a2 = 1.4
phi1 = pi / 8
phi2 = 3 * pi/4
first = a1 * sin(pi * t / 6 + phi1)
second = a2 * sin(pi * t / 3 + phi2)
z = first + second
plot(z, type="o", lty=1, xlab="time", ylab="z",
main="Figure 2-8 Time series with two cyclic components")
lines(first, lty=2, col="blue")
lines(second, lty=3, col="red")
legend("left", legend=c("series", "first", "second"), lty=1:3)
## Figure 2.12
# S-curve
b0 = 0.2
b1 = -12
t = 1:60
z1 = exp(b0 + b1 / t)
# gompertz
b0 = 10
b1 = 0.15
k = 1
z2 = k * exp(-b0 * exp(-b1 * t))
# von
b0 = 0.95
b1 = 0.09
z3 = (1 - b0 * exp((-b1) * t)^3)
# Pear 1
b0 = 5
b1 = -0.2
k = 1
z4 = k / (1 + exp(b0 + b1 * t))
z = data.frame(z1, z2, z3, z4)
z.ts = ts(z)
ts.plot(z.ts, lty=1:4, main="Figure 2-12 S-Cruves")
legend("right", legend=c("Exp", "Gompertz", "Von", "Pearl"), lty=1:4)
## Exersize 2.2
z = c(303, 298, 303, 314, 303, 314, 310, 324, 317, 326, 323, 324,331, 330, 332)
t = 1:length(z)
z.ts = ts(z)
model = lm(z ~ t)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
acf(resid(model))
new_data = data.frame(t=c(16,17,18,19,20))
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
new_z = c(z, pred$fit)
new_z.ts = ts(new_z)
ts.plot(new_z.ts, type="o")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$upr, lty=2, col="blue")
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
acf(resid(model))
new_data = data.frame(t=c(16,17,18,19,20))
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
new_z = c(z, pred$fit)
new_z.ts = ts(new_z)
ts.plot(new_z.ts, type="o")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$upr, lty=2, col="blue")
pred
pred$fit
## Exercise 2.6
dept = scan("data/depart.txt")
t = 1:length(dept)
dept.ts = ts(dept, frequency=12, start=c(1984, 1))
lndept = log(dept.ts)
ts.plot(dept.ts)
x1 = sin(2 * pi * t / 12)
x2 = cos(2 * pi * t / 12)
x3 = sin(2 * pi * t / 12*2)
x4 = cos(2 * pi * t / 12*2)
x5 = sin(2 * pi * t / 12*3)
x6 = cos(2 * pi * t / 12*3)
x7 = sin(2 * pi * t / 12*4)
x8 = cos(2 * pi * t / 12*4)
x9 = sin(2 * pi * t / 12*6)
x10 = cos(2 * pi * t / 12*6)
model = lm(lndept ~ t + x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10)
summary(model)
ts.plot(ts(resid(model)))
acf(resid(model))
ts.plot(ts(resid(model)))
## Exercise 2.9
z = scan("data/book.txt")
t = 1:length(z)
model = lm(book ~ t)
summary(model)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
new_data = data.frame(t=c(31:42))
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
new_z = c(z, pred$fit)
new_z.ts = ts(new_z)
ts.plot(new_z.ts, type="o")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$upr, lty=2, col="blue")
## Exercise 2.9
z = scan("data/book.txt")
t = 1:length(z)
model = lm(book ~ t)
summary(model)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
new_data = data.frame(t=c(31:42))
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
new_z = c(z, pred$fit)
new_z.ts = ts(new_z)
ts.plot(new_z.ts, type="o")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$upr, lty=2, col="blue")
new_data = data.frame(t=c(31:42))
new_data
new_data$t
pred
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
## Exercise 2.9
z = scan("data/book.txt")
t = 1:length(z)
## Exercise 2.9
book = scan("data/book.txt")
t = 1:length(z)
model = lm(book ~ t)
summary(model)
ts.plot(resid(model), type="o", ylab="residual")
abline(h=0)
new_data = data.frame(t=c(31:42))
pred = data.frame(predict(model, newdata=new_data, interval='confidence'))
new_z = c(z, pred$fit)
new_z.ts = ts(new_z)
ts.plot(new_z.ts, type="o")
lines(new_data$t, pred$lwr, lty=2, col="blue")
lines(new_data$t, pred$upr, lty=2, col="blue")
dept = scan("data/depart.txt")
t = 1:length(dept)
dept.ts = ts(dept, frequency=12, start=c(1984, 1))
lndept = log(dept.ts)
ts.plot(dept.ts)
x1 = sin(2 * pi * t / 12)
x2 = cos(2 * pi * t / 12)
x3 = sin(2 * pi * t / 12*2)
x4 = cos(2 * pi * t / 12*2)
x5 = sin(2 * pi * t / 12*3)
x6 = cos(2 * pi * t / 12*3)
x7 = sin(2 * pi * t / 12*4)
x8 = cos(2 * pi * t / 12*4)
x9 = sin(2 * pi * t / 12*6)
x10 = cos(2 * pi * t / 12*6)
model = lm(lndept ~ t + x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10)
summary(model)
ts.plot(ts(resid(model)))
acf(resid(model))
ts.plot(ts(resid(model)))
acf(resid(model))
